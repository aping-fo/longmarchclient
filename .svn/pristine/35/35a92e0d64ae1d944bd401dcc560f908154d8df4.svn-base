{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\FamilyPanel.js"],"names":["UIHelper","require","PopupTipsNode","GameManager","WXTool","FAMILY_MEMBER_MAX","cc","Class","extends","Component","properties","nameLb","type","Label","default","coinLb","memberContentNode","Node","memberItemNode","memberInviteNode","modifyNameNode","tipsNode","dissolveOrExitBtn","dissolveOrExitNode","onLoad","start","active","m_isCreator","_this","getInstance","Family_GetInfo","familyInfo","info","creatorOpenId","myInfo","openId","updateInfo","onBackBtnClick","string","name","score","groupMembers","sort","a","b","setParent","i","item","children","memberInfo","instantiate","getChildByName","getComponent","nickName","SetImageFromUrl","find","Sprite","avatarUrl","btn","LoadScene","onInviteMemberClick","shareToJoinFamily","id","wxName","appearWithText","lauchOption","onRemoveMemberClick","event","target","parent","Family_RemoveMember","resp","onShowModifyNameBtnClick","Animation","play","onCloseModifyNameBtnClick","onModifyNameBtnClick","EditBox","length","Family_ModifyName","onShowTipsBtnClick","onCloseTipsBtnClick","onShowDissolveOrExitBtnClick","contentLb","onCloseDissolveOrExitBtnClick","onDissolveOrExitBtnClick","Family_Dissolve","Family_Exit"],"mappings":"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","file":"FamilyPanel.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar UIHelper = require(\"UIHelper\");\r\nvar PopupTipsNode = require(\"PopupTipsNode\");\r\nvar GameManager = require(\"GameManager\");\r\nvar WXTool = require(\"WXTool\");\r\n\r\nconst FAMILY_MEMBER_MAX = 8;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        nameLb: {\r\n            type: cc.Label,\r\n            default: null\r\n        },\r\n        \r\n        coinLb: {\r\n            type: cc.Label,\r\n            default: null\r\n        },\r\n\r\n        memberContentNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        memberItemNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        memberInviteNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        modifyNameNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        tipsNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        dissolveOrExitBtn: {\r\n            type: cc.Node,\r\n            default: null\r\n        },\r\n\r\n        dissolveOrExitNode: {\r\n            type: cc.Node,\r\n            default: null\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n    },\r\n\r\n    start () {\r\n        this.dissolveOrExitNode.active = false;\r\n        this.tipsNode.active = false;\r\n        this.modifyNameNode.active = false;\r\n\r\n        this.m_isCreator = false;\r\n\r\n        var _this = this;\r\n        GameManager.getInstance().Family_GetInfo(function(familyInfo){\r\n            _this.m_isCreator = familyInfo.info.creatorOpenId == GameManager.getInstance().myInfo.openId;\r\n            _this.updateInfo(familyInfo);\r\n        });\r\n    },\r\n\r\n    updateInfo(familyInfo){\r\n        if(familyInfo.info == null){\r\n            this.onBackBtnClick();\r\n        }else{\r\n            this.nameLb.string = familyInfo.info.name;\r\n            this.coinLb.string = familyInfo.info.score;\r\n\r\n            var creatorOpenId = familyInfo.info.creatorOpenId;\r\n\r\n            familyInfo.info.groupMembers.sort(function(a,b){\r\n                if(creatorOpenId == a.openId){\r\n                    return -1;\r\n                }\r\n                if(creatorOpenId == b.openId){\r\n                    return 1;\r\n                }\r\n                return 0;\r\n            });\r\n            \r\n            this.memberInviteNode.setParent(null);\r\n\r\n            for(var i = 0; i < FAMILY_MEMBER_MAX; i++){\r\n                var item = this.memberContentNode.children[i];\r\n                var memberInfo = familyInfo.info.groupMembers[i];\r\n\r\n                if(memberInfo != null){\r\n                    if(item == null){\r\n                        item = cc.instantiate(this.memberItemNode);\r\n                        item.setParent(this.memberContentNode);\r\n                    }\r\n                    item.getChildByName(\"lb_name\").getComponent(cc.Label).string = memberInfo.nickName;\r\n                    UIHelper.SetImageFromUrl(cc.find(\"touxiang1/avatar/img_avatar\", item).getComponent(cc.Sprite), memberInfo.avatarUrl, true);\r\n                    item.name = memberInfo.openId;\r\n\r\n                    if(creatorOpenId == memberInfo.openId){\r\n                        cc.find(\"position/lb_position\", item).getComponent(cc.Label).string = \"群主\";\r\n                        item.getChildByName(\"delete_btn\").active = false;\r\n                    }else{\r\n                        cc.find(\"position/lb_position\", item).getComponent(cc.Label).string = \"成员\";\r\n\r\n                        if(this.m_isCreator){\r\n                            item.getChildByName(\"delete_btn\").active = true;\r\n                        }else{\r\n                            item.getChildByName(\"delete_btn\").active = false;\r\n                        }\r\n                    }\r\n                }else if(item != null){\r\n                    item.active = false;\r\n                }\r\n            }\r\n            this.memberInviteNode.setParent(this.memberContentNode);\r\n        }\r\n\r\n        if(this.m_isCreator){\r\n            this.dissolveOrExitBtn.getChildByName(\"Label\").getComponent(cc.Label).string = \"解散群\";\r\n        }else{\r\n            this.dissolveOrExitBtn.getChildByName(\"Label\").getComponent(cc.Label).string = \"退出群\";\r\n        }\r\n    },\r\n\r\n    onBackBtnClick(btn){\r\n        GameManager.getInstance().LoadScene(\"main\");\r\n    },\r\n\r\n    onInviteMemberClick(btn){\r\n        var familyInfo = GameManager.getInstance().familyInfo;\r\n        \r\n        if(familyInfo == null || familyInfo.info == null){\r\n            return;\r\n        }\r\n\r\n        //share\r\n        WXTool.getInstance().shareToJoinFamily(familyInfo.info.id, familyInfo.info.name, GameManager.getInstance().myInfo.wxName, function(){\r\n            PopupTipsNode.appearWithText(\"邀请成功\");\r\n        },function(){\r\n            GameManager.getInstance().lauchOption=null;\r\n        });\r\n    },\r\n\r\n    onRemoveMemberClick(event){\r\n        if(!this.m_isCreator){\r\n            return;\r\n        }\r\n        var openId = event.target.parent.name;\r\n        var _this = this;\r\n        GameManager.getInstance().Family_RemoveMember(openId, function(resp){\r\n            _this.updateInfo(resp);\r\n        });\r\n    },\r\n\r\n    ////////////////////////// 改名字 /////////////////////////\r\n    onShowModifyNameBtnClick(btn){\r\n        if(!this.m_isCreator){\r\n            PopupTipsNode.appearWithText(\"不是创建者不能改名\");\r\n            return;\r\n        }\r\n        this.modifyNameNode.getComponent(cc.Animation).play(\"group_modifyName\");\r\n        this.modifyNameNode.active = true;\r\n    },\r\n\r\n    onCloseModifyNameBtnClick(btn){\r\n        this.modifyNameNode.active = false;\r\n    },\r\n\r\n    onModifyNameBtnClick(btn){\r\n        var name = cc.find(\"panel/eb_name\", this.modifyNameNode).getComponent(cc.EditBox).string;\r\n        \r\n        if(name.length == 0){\r\n            PopupTipsNode.appearWithText(\"名字不能为空\");\r\n            return;\r\n        }\r\n        this.onCloseModifyNameBtnClick();\r\n\r\n        var _this = this;\r\n        GameManager.getInstance().Family_ModifyName(name, function(resp){\r\n            _this.nameLb.string = name;\r\n        });\r\n    },\r\n\r\n    ////////////////////////// 说明 /////////////////////////\r\n    onShowTipsBtnClick(btn){\r\n        this.tipsNode.active = true;\r\n    },\r\n\r\n    onCloseTipsBtnClick(btn){\r\n        this.tipsNode.active = false;\r\n    },\r\n    \r\n    ////////////////////////// 退出群或解散群 /////////////////////////\r\n    onShowDissolveOrExitBtnClick(btn){\r\n        this.dissolveOrExitNode.active = true;\r\n\r\n        var contentLb = this.dissolveOrExitNode.getChildByName(\"lb_content\").getComponent(cc.Label);\r\n        if(this.m_isCreator){\r\n            contentLb.string = \"真的要解散群吗？\";\r\n        }else{\r\n            contentLb.string = \"真的要退出群吗？\";\r\n        }\r\n    },\r\n\r\n    onCloseDissolveOrExitBtnClick(btn){\r\n        this.dissolveOrExitNode.active = false;\r\n    },\r\n\r\n    onDissolveOrExitBtnClick(btn){\r\n        var _this = this;\r\n        if(this.m_isCreator){\r\n            GameManager.getInstance().Family_Dissolve(function(resp){\r\n                _this.onBackBtnClick();\r\n                PopupTipsNode.appearWithText(\"解散成功\");\r\n            });\r\n        }else{\r\n            GameManager.getInstance().Family_Exit(function(resp){\r\n                _this.onBackBtnClick();\r\n                PopupTipsNode.appearWithText(\"退出成功\");\r\n            });\r\n        }\r\n    }\r\n});\r\n"]}