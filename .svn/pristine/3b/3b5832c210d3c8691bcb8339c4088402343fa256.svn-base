{"version":3,"sources":["WXTool.js"],"names":["enable","AdUnitID","ShareImages","Const","OpenDataKey_Score","StorageKey_NewPlayer","WXTool","cc","Class","statics","instance","getInstance","ctor","m_isLogin","m_loginBtn","m_advertiseVideo","advertiseVideoReady","initShare","reset","login","setOpenId","getUserInfo","_this","wx","success","console","log","res","setCode","getSetting","authSetting","userInfoSetting","getSystemInfoSync","screenWidth","screenHeight","button","createUserInfoButton","type","image","loader","md5Pipe","transformURL","url","raw","style","left","top","width","height","onTap","fail","openId","m_openId","initRankInfo","getOpenId","parseInt","Math","random","code","m_code","getCode","getUserInfoSuccess","hide","errMsg","indexOf","m_avatarUrl","userInfo","avatarUrl","m_nickName","nickName","loginSuccess","getWxName","getAvatarUrl","initAdvertiseVideo","director","emit","updateShareMenu","withShareTicket","showShareMenu","share","rand","floor","length","shareAppMessage","title","imageUrl","shareToPlayTogether","invitorName","roomId","callback","failCallBack","text","query","shareToJoinFamily","familyId","familyName","shareWithImage","canvas","toTempFilePathSync","destWidth","destHeight","advertiseVideo","createRewardedVideoAd","adUnitId","onClose","isEnded","undefined","onLoad","onError","err","showAdvertiseVideo","successCallback","failCallback","show","then","catch","load","openDataContext","getOpenDataContext","postMessage","eventType","openFriendRank","myInfo","openPlayerRank","data","from","datas","reportScore","score","setUserCloudStorage","KVDataList","key","value","getLaunchOptionsSync","wxOnShow","onShow","ensureDirFor","path","fs","getFileSystemManager","ensureDir","dirname","access","mkdir","dirPath","complete","saveFileToLocal","fromPath","saveFile","tempFilePath","savedFilePath","saveImageToAlbum","Promise","resolve","reject","authorize","scope","saveImageToPhotosAlbum","filePath"],"mappings":"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","file":"WXTool.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["/**\r\n * 微信工具\r\n */\r\nconst enable = false;   //微信是否开启。方便本地调试\r\nconst AdUnitID = \"adunit-1f9bfa04c0bd5e7f\";\r\nconst ShareImages = [\"resources/shareImg/share.png\"];\r\n\r\nvar Const = {\r\n    OpenDataKey_Score: \"totalScore\",\r\n\r\n    StorageKey_NewPlayer: \"newPlayer\",\r\n};\r\n\r\nvar WXTool = cc.Class({\r\n    statics: {\r\n        instance: null,\r\n        getInstance: function () {\r\n            return this.instance || (this.instance = new WXTool()), this.instance;\r\n        },\r\n        enable: enable,\r\n    },\r\n\r\n    ctor: function () {\r\n        this.m_isLogin = false;\r\n        this.m_loginBtn = null;\r\n        \r\n        this.m_advertiseVideo = null;\r\n        this.advertiseVideoReady = false;\r\n\r\n        this.initShare();\r\n    }, \r\n    reset() {\r\n        this.m_isLogin = false;\r\n        this.m_loginBtn = null;\r\n    },\r\n\r\n    //登陆\r\n    login() {\r\n        if (this.m_isLogin) {\r\n            return;\r\n        }\r\n\r\n        if (!enable) {\r\n            this.setOpenId();\r\n            this.getUserInfo();\r\n            return;\r\n        }\r\n        var _this = this;\r\n\r\n        wx.login({\r\n            success: res => {\r\n                console.log(\"login success\");\r\n                console.log(res['code']);\r\n                _this.setCode(res['code']);\r\n\r\n                //获取用户授权\r\n                wx.getSetting({\r\n                    success: function (res) {\r\n                        var authSetting = res.authSetting;\r\n                        var userInfoSetting = authSetting['scope.userInfo'];\r\n                        if (userInfoSetting === true) {\r\n                            //用户成功授权\r\n                            console.log(\"Request WX UserInfo Success\");\r\n                            _this.getUserInfo();\r\n                        } else {\r\n                            if (userInfoSetting === false) {\r\n                                // 处理用户拒绝授权的情况\r\n                                console.log(\"Request WX UserInfo False\");\r\n                            } else {\r\n                                console.log(\"Request WX UserInfo Ask\");\r\n                            }\r\n\r\n                            //弹出询问框\r\n                            let { screenWidth, screenHeight } = wx.getSystemInfoSync();\r\n                            console.log(screenWidth);\r\n                            console.log(screenHeight);\r\n                            var button = wx.createUserInfoButton({\r\n                                type: 'image',\r\n                                image: cc.loader.md5Pipe.transformURL(cc.url.raw(\"resources/startBtn.png\")),\r\n                                style: {\r\n                                    left: (screenWidth - 125) / 2,\r\n                                    top: (screenHeight - 60),\r\n                                    width: 125,\r\n                                    height: 54.5\r\n                                }\r\n                            });\r\n\r\n                            button.onTap((res) => {\r\n                                _this.getUserInfo();\r\n                            });\r\n\r\n                            _this.m_loginBtn = button;\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n            fail: () => {\r\n                console.log(\"login fail\");\r\n            }\r\n        });\r\n    },\r\n\r\n    //获取Openid\r\n    setOpenId(openId) {\r\n        this.m_openId = openId ? openId : \"\";\r\n\r\n        this.initRankInfo(this.m_openId);\r\n    },\r\n    //获取Openid\r\n    getOpenId() {\r\n        return enable ? this.m_openId : parseInt(Math.random() * 99);\r\n    },\r\n    //登录code\r\n    setCode(code) {\r\n        this.m_code = code;\r\n    },\r\n\r\n    getCode() {\r\n        return enable ? this.m_code : \"\"\r\n    },\r\n    //获取用户头像和名字信息\r\n    getUserInfo() {\r\n        if (!enable) {\r\n            this.getUserInfoSuccess();\r\n            return;\r\n        }\r\n        var _this = this;\r\n        wx.getUserInfo({\r\n            success: function (res) {\r\n                console.log(\"getUserInfo success\");\r\n                console.log(res);\r\n                _this.getUserInfoSuccess(res);\r\n\r\n                if (_this.m_loginBtn != null) {\r\n                    _this.m_loginBtn.hide();\r\n                    _this.m_loginBtn = null;\r\n                }\r\n            },\r\n\r\n            fail: function (res) {\r\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\r\n                if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\r\n                    // 处理用户拒绝授权的情况\r\n                    console.log(\"Request WX UserInfo False\");\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    getUserInfoSuccess(res) {\r\n        if (res) {\r\n            this.m_avatarUrl = res.userInfo.avatarUrl;\r\n            this.m_nickName = res.userInfo.nickName;\r\n        }\r\n\r\n        this.loginSuccess();\r\n    },\r\n    getWxName() {\r\n        return enable ? this.m_nickName : \"测试\";\r\n    },\r\n    getAvatarUrl() {\r\n        return enable ? this.m_avatarUrl : \"\";\r\n    },\r\n    //登陆成功\r\n    loginSuccess() {\r\n        this.m_isLogin = true;\r\n        \r\n        this.initAdvertiseVideo();\r\n\r\n        cc.director.emit(\"WXLoginSuccess\");\r\n    },\r\n\r\n    /**\r\n     * 分享\r\n     */\r\n    initShare() {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        wx.updateShareMenu({\r\n            withShareTicket: true\r\n        });\r\n\r\n        wx.showShareMenu();\r\n    },\r\n\r\n    //分享指定图片\r\n    share() {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var rand = Math.floor(Math.random() * ShareImages.length);\r\n\r\n        wx.shareAppMessage({\r\n            title: '养生大师',\r\n            imageUrl: cc.loader.md5Pipe.transformURL(cc.url.raw(ShareImages[rand])),\r\n            success: function (res) {\r\n                cc.director.emit(\"RecoverEnerge\");\r\n            },\r\n\r\n            fail: function (res) {\r\n            }\r\n        });\r\n    },\r\n    //邀请好友\r\n    shareToPlayTogether(invitorName, roomId, callback,failCallBack) {\r\n        if (!enable) {\r\n            callback();\r\n            return;\r\n        }\r\n\r\n        var rand = Math.floor(Math.random() * ShareImages.length);\r\n        var text = invitorName + \"邀请你加入挑战\";\r\n        wx.shareAppMessage({\r\n            title: text,\r\n            imageUrl: cc.loader.md5Pipe.transformURL(cc.url.raw(ShareImages[rand])),\r\n            query: \"roomId=\" + roomId,\r\n            success: function (res) {\r\n                callback();\r\n            },\r\n\r\n            fail: function (res) {\r\n                if(failCallBack != null)\r\n                {\r\n                    failCallBack();\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    //邀请好友加入家庭群\r\n    shareToJoinFamily(familyId, familyName, invitorName, callback,failCallBack){\r\n        if (!enable) {\r\n            callback();\r\n            return;\r\n        }\r\n\r\n        var rand = Math.floor(Math.random() * ShareImages.length);\r\n        var text = invitorName + \"邀请您加入家庭群：\" + familyName;\r\n\r\n        wx.shareAppMessage({\r\n            title: text,\r\n            imageUrl: cc.loader.md5Pipe.transformURL(cc.url.raw(ShareImages[rand])),\r\n            query: \"familyId=\" + familyId + \"&invitorName=\" + invitorName,\r\n            success: function (res) {\r\n                callback();\r\n            },\r\n\r\n            fail: function (res) {\r\n                if(failCallBack != null)\r\n                {\r\n                    failCallBack();\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    //分享屏幕截图\r\n    shareWithImage() {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        wx.shareAppMessage({\r\n            title: '求婚101',\r\n            imageUrl: canvas.toTempFilePathSync({\r\n                destWidth: 500,\r\n                destHeight: 400\r\n            }),\r\n            success: function (res) {\r\n                cc.director.emit(\"Reborn\");\r\n            },\r\n\r\n            fail: function (res) {\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * 广告\r\n     */\r\n    initAdvertiseVideo() {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var advertiseVideo = wx.createRewardedVideoAd({ adUnitId: AdUnitID });\r\n        var _this = this;\r\n        advertiseVideo.onClose(res => {\r\n            // 用户点击了【关闭广告】按钮\r\n            // 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n            if (res && res.isEnded || res === undefined) {\r\n                // 正常播放结束，可以下发游戏奖励\r\n                cc.director.emit(\"PlayAdvertiseVideoDone\", true);\r\n            }\r\n            else {\r\n                // 播放中途退出，不下发游戏奖励\r\n                cc.director.emit(\"PlayAdvertiseVideoDone\", false);\r\n            }\r\n        });\r\n\r\n        advertiseVideo.onLoad(() => {\r\n            _this.advertiseVideoReady = true;\r\n        });\r\n\r\n        advertiseVideo.onError((err) => {\r\n            console.log('load AdvertiseVideo Error', err);\r\n            _this.advertiseVideoReady = false;\r\n        });\r\n\r\n        this.m_advertiseVideo = advertiseVideo;\r\n    },\r\n\r\n    showAdvertiseVideo(successCallback, failCallback) {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var _this = this;\r\n        this.m_advertiseVideo.show().then(() => {\r\n            if (successCallback) {\r\n                successCallback();\r\n            }\r\n            _this.advertiseVideoReady = false;\r\n        }).catch((err) => {\r\n            console.log('show AdvertiseVideo Error', err);\r\n            this.m_advertiseVideo.load().then(() => {\r\n                this.m_advertiseVideo.show()\r\n                if (successCallback) {\r\n                    successCallback();\r\n                }\r\n                _this.advertiseVideoReady = false;\r\n            }).catch((err) => {\r\n                console.log('load AdvertiseVideo Error', err);\r\n                if (failCallback) {\r\n                    failCallback();\r\n                }\r\n            });\r\n        });\r\n    },\r\n\r\n    /**\r\n     * 排行榜\r\n     */\r\n    //初始化排行榜信息\r\n    initRankInfo(openId) {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var openDataContext = wx.getOpenDataContext();\r\n        openDataContext.postMessage({ eventType: 1, openId: openId});\r\n    },\r\n\r\n    //切换好友排行\r\n    openFriendRank(myInfo) {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var openDataContext = wx.getOpenDataContext();\r\n        openDataContext.postMessage({ eventType: 2, myInfo: myInfo});\r\n    },\r\n\r\n    //切换玩家排行\r\n    openPlayerRank(data, from, myInfo) {\r\n        if (!enable) {\r\n            return;\r\n        }\r\n\r\n        var openDataContext = wx.getOpenDataContext();\r\n        openDataContext.postMessage({eventType: 3, datas: { data: data, from: from}, myInfo: myInfo});\r\n    },\r\n\r\n    //打开超越好友分享面板\r\n    // openSharePanel(){\r\n    //     if(!enable){\r\n    //         return;\r\n    //     }\r\n\r\n    //     var openDataContext = wx.getOpenDataContext();\r\n    //     openDataContext.postMessage({eventType: 2});\r\n    // },\r\n\r\n    //上报分数\r\n    reportScore(score) {\r\n        if(!enable){\r\n            return;\r\n        }\r\n        wx.setUserCloudStorage({\r\n            KVDataList: [{ key: Const.OpenDataKey_Score, value: score + '' }],\r\n            success: res => {\r\n                console.log(res);\r\n            },\r\n            fail: res => {\r\n                console.log(res);\r\n            }\r\n        });\r\n    },\r\n\r\n    //获取卡片传入参数\r\n    getLaunchOptionsSync() {\r\n        if (!enable) {\r\n            return null;\r\n        }\r\n        return wx.getLaunchOptionsSync();\r\n    },\r\n\r\n    wxOnShow(callback) {\r\n        if (enable) {\r\n            wx.onShow(function (res) {\r\n                callback(res)\r\n            });\r\n        }\r\n    },\r\n\r\n    ensureDirFor(path, callback){\r\n        // cc.log('mkdir:' + path);\r\n        if(!enable){\r\n            return;\r\n        }\r\n\r\n        var _this = this;\r\n        var fs = wx.getFileSystemManager();\r\n        var ensureDir = cc.path.dirname(path);\r\n        if (ensureDir === \"wxfile://usr\" || ensureDir === \"http://usr\") {\r\n            callback();\r\n            return;\r\n        }\r\n        fs.access({\r\n            path: ensureDir,\r\n            success: callback,\r\n            fail: function (res) {\r\n                _this.ensureDirFor(ensureDir, function () {\r\n                    fs.mkdir({\r\n                        dirPath: ensureDir,\r\n                        complete: callback,\r\n                    });\r\n                });\r\n            },\r\n        });\r\n    },\r\n\r\n    saveFileToLocal(fromPath, callback){\r\n        if(!enable){\r\n            return;\r\n        }\r\n\r\n        // var localPath = wx.env.USER_DATA_PATH + '/' + toPath;\r\n        var fs = wx.getFileSystemManager();\r\n        fs.saveFile({\r\n            tempFilePath: fromPath,\r\n            success: function(res){\r\n                if(callback){\r\n                    callback(\"success\", res.savedFilePath);\r\n                }\r\n            },\r\n\r\n            fail: function(res){\r\n                console.log(res.errMsg);\r\n                if(callback){\r\n                    callback(\"fail\");\r\n                }\r\n            }\r\n        });\r\n        // this.ensureDirFor(localPath, function () {\r\n        //     fs.saveFile({\r\n        //         tempFilePath: fromPath, \r\n        //         filePath: toPath,\r\n        //         success: function(res){\r\n        //             if(callback){\r\n        //                 callback(\"success\", res.savedFilePath);\r\n        //             }\r\n        //         },\r\n\r\n        //         fail: function(res){\r\n        //             console.log(res.errMsg);\r\n        //             if(callback){\r\n        //                 callback(\"fail\");\r\n        //             }\r\n        //         }\r\n        //     });\r\n        // });\r\n    },\r\n\r\n    //保存图片到相册\r\n    saveImageToAlbum(path, callback){\r\n        if(!enable){\r\n            return;\r\n        }\r\n\r\n        new Promise(function(resolve, reject){\r\n            wx.authorize({\r\n                scope: \"scope.writePhotosAlbum\",\r\n                success: function(){\r\n                    resolve();\r\n                },\r\n\r\n                fail: function(){\r\n                    reject();\r\n                }\r\n            })\r\n        }).then(function(){\r\n            wx.saveImageToPhotosAlbum({\r\n                filePath: path,\r\n                success: function(){\r\n                    if(callback){\r\n                        callback(\"success\");\r\n                    }\r\n                },\r\n\r\n                fail: function(){\r\n                    if(callback){\r\n                        callback(\"fail\");\r\n                    }\r\n                }\r\n            });\r\n        }).catch(function(){\r\n            if(callback){\r\n                callback(\"fail\");\r\n            }\r\n        });\r\n    }\r\n});"]}