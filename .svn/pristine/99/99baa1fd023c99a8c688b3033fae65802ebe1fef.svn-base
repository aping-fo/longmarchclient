{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\tools/assets\\scripts\\tools\\HttpReq.js"],"names":["Alert","require","WXTool","errorCount","Base64","md5","appScript","url","version","secret","openId","oppExitCallback","errorHandler","Get","reqData","callback","self","item","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","responseText","responseJson","JSON","parse","console","log","ip","open","send","Post","cmd","show","getInstance","reset","cc","director","loadScene","param","data","stringify","utfdata","utf16to8","base64data","base64encode","encodeURI","replace","s","hex_md5","parseInt","urlOut","setRequestHeader","module","exports"],"mappings":"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","file":"HttpReq.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\tools","sourcesContent":["var Alert=require(\"Alert\")\r\nvar WXTool = require(\"WXTool\")\r\nvar errorCount=0;\r\nvar Base64 = require(\"Base64\");\r\nvar md5=require(\"md5\");\r\n\r\nvar appScript = {\r\n    // url: 'http://192.168.0.116:8446/medicine',\r\n    // url: 'https://mary101.luckygz.com:8445/medicine',\r\n    url: 'https://wcgame.luckygz.com:8445/medicine',\r\n    // url: 'http://192.168.0.156:8129/medicine',\r\n    // url: 'http://127.0.0.1:8446/medicine',\r\n    version: \"1.0.0\",   \r\n    secret:'cJpSzEU0KcWybxhkKp47DSvUZTpgfEAuht72XHiL',\r\n    openId:0,\r\n    oppExitCallback:null,//对手退出\r\n    errorHandler:[],\r\n    Get: function(url,reqData,callback){\r\n        var self = this;\r\n\r\n        url += \"?\";\r\n        \r\n        for(var item in reqData){\r\n            url += item +\"=\" +reqData[item] +\"&\";\r\n        }\r\n        // console.log(self.ip + url)\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4){\r\n                if(xhr.status >= 200 && xhr.status < 400){\r\n                    var response = xhr.responseText;\r\n                    // console.log(response)\r\n                    if(response){\r\n                        var responseJson = JSON.parse(response);\r\n                        callback(responseJson);\r\n                    }else{\r\n                        console.log(\"返回数据不存在\")\r\n                        callback(false);\r\n                    }\r\n                }else{\r\n                    console.log(\"请求失败\")\r\n                    callback(false);\r\n                }\r\n            }\r\n        };\r\n        url=self.ip + url;\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.send();\r\n        \r\n    },\r\n\r\n    Post: function (cmd, reqData, callback) {\r\n       \r\n        if(errorCount>50)\r\n        {\r\n            Alert.show(\"失去连接，是否重连\",function(){\r\n                errorCount=0;\r\n                WXTool.getInstance().reset();\r\n                cc.director.loadScene(\"begin\", function(){\r\n                });\r\n            },function(){},\"\",0.3)\r\n            return;\r\n        }\r\n        reqData = reqData == null?{}:reqData;\r\n        var self = this;\r\n        // console.log(url)\r\n        // console.log(reqData)\r\n        //1.拼接请求参数\r\n        var param = \"cmd=\"+cmd+\"&\"+\"openId=\"+this.openId;\r\n        var data='';\r\n        if(reqData != null)\r\n        {\r\n            data=JSON.stringify(reqData);\r\n        }\r\n        var utfdata=Base64.utf16to8(data);\r\n        var base64data=Base64.base64encode(utfdata);\r\n        base64data=encodeURI(base64data).replace(/\\+/g,'%2B')\r\n        var s=md5.hex_md5(self.secret+\"&\"+utfdata);\r\n        \r\n        param=param+\"&data=\"+base64data+\"&s=\"+s;\r\n        //2.发起请求\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4){\r\n                if(xhr.status >= 200 && xhr.status < 400){\r\n                    var response = xhr.responseText;\r\n                    // console.log(response)\r\n                    if(response){\r\n                        var responseJson = JSON.parse(response);\r\n                        if(responseJson['code'] == '200')\r\n                        {\r\n                            var data=JSON.parse(responseJson['data']);\r\n                            callback(data);\r\n                        }\r\n                        else if(responseJson['code'] == '510')\r\n                        {\r\n                            if(self.oppExitCallback != null)\r\n                            {\r\n                                self.oppExitCallback();\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            if(self.errorHandler[cmd+'_'+responseJson['code']] != null)\r\n                            {\r\n                                self.errorHandler[cmd+'_'+responseJson['code']]();\r\n                            }\r\n                            \r\n                            if(parseInt(responseJson['code'])<800)\r\n                            {\r\n                                errorCount++;\r\n                            }\r\n                           \r\n                        }\r\n                        \r\n                    }else{\r\n                        console.log(\"返回数据不存在\")\r\n                        callback(false);\r\n                    }\r\n                }else{\r\n                    console.log(\"请求失败\")\r\n                    errorCount++;\r\n                    callback(false);\r\n                }\r\n            }\r\n        };\r\n        xhr.open(\"POST\", self.urlOut?self.urlOut:self.url, true);\r\n        xhr.setRequestHeader(\"Content-Type\" , \"application/x-www-form-urlencoded\");  \r\n        xhr.send(param);//reqData为字符串形式： \"key=value\"\r\n    },\r\n\r\n\r\n};\r\n\r\nmodule.exports = appScript;"]}