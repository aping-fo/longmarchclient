{"version":3,"sources":["shopPanel.js"],"names":["GameManager","require","httpReq","Alert","data","selectedId","cc","Class","extends","Component","properties","item","default","type","Node","serializable","itemCanvas","infoBoard","btn_cancel","Button","btn_confirm","lbl_name","EditBox","lbl_address","lbl_phone","lbl_currentCoin","Label","items","onLoad","node","on","onCancel","onConfirm","errorHandler","show","setItemContent","find","getComponent","string","name","pts","itemClick","event","idx","indexOf","target","id","need","have","getInstance","shopType","myInfo","score","limitScore","active","ConsumeMallItems","resp","console","log","start","_this","setScale","GetMallItems","Array","mallItems","total","length","i","instantiate","parent","push","action","sequence","scaleTo","runAction","onBackToMain","btn","director","loadScene"],"mappings":"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","file":"shopPanel.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var GameManager = require(\"GameManager\");\r\nvar httpReq=require('HttpReq');\r\nvar Alert = require(\"Alert\");\r\nvar data;\r\nvar selectedId;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        item: {\r\n            default: null,                                  \r\n            type: cc.Node, \r\n            serializable: true,   \r\n        },\r\n        itemCanvas: {\r\n            default: null,                                  \r\n            type: cc.Node, \r\n            serializable: true,   \r\n        },\r\n        infoBoard: {\r\n            default: null,                                  \r\n            type: cc.Node, \r\n            serializable: true,   \r\n        },\r\n        btn_cancel: {\r\n            default: null,                                  \r\n            type: cc.Button, \r\n            serializable: true,   \r\n        },\r\n        btn_confirm: {\r\n            default: null,                                  \r\n            type: cc.Button, \r\n            serializable: true,   \r\n        },\r\n        lbl_name: {\r\n            default: null,                                  \r\n            type: cc.EditBox, \r\n            serializable: true,   \r\n        },\r\n        lbl_address: {\r\n            default: null,                                  \r\n            type: cc.EditBox, \r\n            serializable: true,   \r\n        },\r\n        lbl_phone: {\r\n            default: null,                                  \r\n            type: cc.EditBox, \r\n            serializable: true,   \r\n        },\r\n        lbl_currentCoin: {\r\n            default: null,\r\n            type: cc.Label,\r\n            serializable: true,\r\n        },\r\n        items:[cc.Node]\r\n    },\r\n\r\n\r\n    onLoad () {\r\n      \r\n        this.btn_cancel.node.on(\"click\", this.onCancel, this);\r\n        this.btn_confirm.node.on(\"click\", this.onConfirm, this);\r\n        httpReq.errorHandler['5001'+'_'+'900']= function(){Alert.show('积分不足',function(){},false)};\r\n    },\r\n    setItemContent(data,item)\r\n    {\r\n        cc.find(\"renderNode/lbl_name\",item).getComponent(cc.Label).string=data.name;\r\n        cc.find(\"renderNode/lbl_pts\",item).getComponent(cc.Label).string='积分'+data.pts;\r\n    },\r\n    itemClick(event)\r\n    {\r\n        var idx=this.items.indexOf(event.target);\r\n        selectedId=data[idx].id;\r\n        var need=data[idx].pts;\r\n        var have=GameManager.getInstance().shopType == 0?GameManager.getInstance().myInfo.score:GameManager.getInstance().myInfo.limitScore;\r\n        if(have<need)\r\n        {\r\n            Alert.show('积分不足',function(){},false)\r\n        }\r\n        else\r\n        {\r\n            this.infoBoard.active=true;\r\n        }\r\n        \r\n    },\r\n    onCancel(event)\r\n    {\r\n        this.infoBoard.active=false;\r\n    },\r\n    onConfirm(event)\r\n    {\r\n        GameManager.getInstance().ConsumeMallItems(this.lbl_name.string,this.lbl_phone.string,this.lbl_address.string,selectedId,function(resp){\r\n            console.log(resp)\r\n        })\r\n        this.infoBoard.active=false;\r\n    },\r\n    start () {\r\n        this.lbl_currentCoin.string = GameManager.getInstance().shopType == 0?GameManager.getInstance().myInfo.score:GameManager.getInstance().myInfo.limitScore;\r\n        this.infoBoard.active=false;\r\n        var _this=this;\r\n        cc.find('renderNode',_this.item).setScale(0);\r\n        GameManager.getInstance().GetMallItems(function(resp){\r\n            _this.items=new Array();\r\n            data=resp.mallItems;\r\n            var total=data.length;\r\n            var idx=0;\r\n            cc.find('renderNode',_this.item).setScale(0.2);\r\n            for(var i=0;i<total;i++)\r\n            {\r\n                if(data[i].type == GameManager.getInstance().shopType)\r\n                {\r\n                    var item=(idx == 0)? _this.item:cc.instantiate(_this.item);\r\n                    item.on(\"click\", _this.itemClick, _this);\r\n                    item.parent=_this.itemCanvas;\r\n                    _this.setItemContent(data[i],item)\r\n                    _this.items.push(item);\r\n                    var action=cc.sequence(cc.scaleTo(0.2, 1.03), cc.scaleTo(0.1, 1));\r\n                    cc.find('renderNode',item).runAction(action);\r\n                    idx++;\r\n                } \r\n               \r\n            }\r\n            // _this.itemCanvas.getComponent(cc.Layout).updateLayout();\r\n        })\r\n    },\r\n    onBackToMain(btn)\r\n    {\r\n        cc.director.loadScene('main')\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}