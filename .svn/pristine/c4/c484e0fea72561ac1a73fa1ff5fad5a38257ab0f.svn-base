{"version":3,"sources":["SignPanel.js"],"names":["GameManager","require","AudioManager","PopupTipsNode","CallbackComponent","SignPanel","_sign","_detailLabel","_cancelButton","_enterButton","_enterCallBack","_animSpeed","_sprite","cc","Class","extends","Component","properties","statics","show","reward","enterCallback","enable","type","self","undefined","loader","loadRes","Prefab","error","prefab","sign","instantiate","_main","find","getComponent","Label","_confirmButton","Sprite","setState","_animation","Animation","_type","callbackComponent","addComponent","onFadeInFinish","resumeSystemEvents","onFadeOutFinish","onDestory","Button","interactable","action","sequence","delayTime","callFunc","startFadeOut","runAction","on","onButtonClicked","getChildByName","onCloseBtnClicked","setParent","position","Vec2","ZERO","startFadeIn","configSignPanel","string","pauseSystemEvents","play","event","getInstance","Sign","resp","appearWithText","playEffect","EFFECT_TYPE","MONEY","stopAllActions","destroy","POPUP","start"],"mappings":"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","file":"SignPanel.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import { ENFILE } from \"constants\";\r\nvar GameManager = require(\"GameManager\");\r\nvar AudioManager = require(\"AudioManager\");\r\nvar PopupTipsNode = require(\"PopupTipsNode\");\r\nvar CallbackComponent = require(\"CallbackComponent\");\r\nvar SignPanel = {\r\n    _sign: null,           // prefab\r\n    _detailLabel: null,   // 内容\r\n    _cancelButton: null,   // 确定按钮\r\n    _enterButton: null,   // 取消按钮\r\n    _enterCallBack: null,   // 回调事件\r\n    _animSpeed: 0.3,    // 动画速度\r\n    _sprite: null,   //人物\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n\r\n    },\r\n\r\n    statics: {\r\n\r\n        show(reward, enterCallback,enable,type) {\r\n\r\n            var self = this;\r\n\r\n            // 判断\r\n            if (SignPanel._sign != undefined) return;\r\n\r\n            // SignPanel._animSpeed = 0.2;\r\n            cc.loader.loadRes(\"prefabs/PopupSignNode\", cc.Prefab, function (error, prefab) {\r\n\r\n                if (error) {\r\n                    cc.error(error);\r\n                    return;\r\n                }\r\n\r\n                var sign = cc.instantiate(prefab);\r\n                SignPanel._sign = sign;\r\n                SignPanel._main = cc.find('group', sign);\r\n\r\n                // 动画 \r\n                // var cbFadeOut = cc.callFunc(self.onFadeOutFinish, self);\r\n                // var cbFadeIn = cc.callFunc(self.onFadeInFinish, self);\r\n                // self.actionFadeIn = cc.sequence(cc.spawn(cc.fadeTo(SignPanel._animSpeed, 255), cc.scaleTo(SignPanel._animSpeed, 1.0)), cbFadeIn);\r\n                // self.actionFadeOut = cc.sequence(cc.spawn(cc.fadeTo(SignPanel._animSpeed, 0), cc.scaleTo(SignPanel._animSpeed, 1.2)), cbFadeOut);\r\n\r\n                SignPanel._detailLabel = cc.find(\"info/lb_num\", SignPanel._main).getComponent(cc.Label);\r\n                SignPanel._confirmButton = cc.find(\"receive_Btn\", SignPanel._main);\r\n                SignPanel._confirmButton.getComponent(cc.Sprite).setState(1)\r\n                SignPanel._animation = sign.getComponent(cc.Animation);\r\n                SignPanel._enterCallBack = enterCallback;\r\n                SignPanel._type=type;\r\n\r\n                var callbackComponent = sign.addComponent(CallbackComponent);\r\n                callbackComponent.onFadeInFinish = function () {\r\n                    SignPanel._sign.resumeSystemEvents(true);\r\n                    // cc.eventManager.resumeTarget(SignPanel._sign, true);\r\n                }\r\n                callbackComponent.onFadeOutFinish = function () {\r\n                    self.onDestory();\r\n                }\r\n                SignPanel._confirmButton.getComponent(cc.Button).interactable=enable;\r\n                if(!enable)\r\n                {\r\n                    var action=cc.sequence(cc.delayTime(3),cc.callFunc(function(){\r\n                        self.startFadeOut();\r\n                    }));\r\n                    SignPanel._sign.runAction(action);\r\n                }\r\n                // 添加点击事件\r\n                SignPanel._confirmButton.on('click', self.onButtonClicked, self);\r\n                sign.getChildByName(\"bg2\").on('click', self.onCloseBtnClicked, self);\r\n\r\n                // 父视图\r\n                SignPanel._sign.setParent(cc.find(\"Canvas\"));\r\n                SignPanel._sign.position = cc.Vec2.ZERO;\r\n\r\n                // 展现 sign\r\n                self.startFadeIn();\r\n\r\n                self.configSignPanel(reward);\r\n\r\n            });\r\n\r\n            // 参数\r\n            self.configSignPanel = function (reward) {\r\n\r\n                SignPanel._detailLabel.string = '+' + reward;\r\n\r\n            };\r\n\r\n            // 执行弹进动画\r\n            self.startFadeIn = function () {\r\n                SignPanel._sign.pauseSystemEvents(true);\r\n                // cc.eventManager.pauseTarget(SignPanel._main, true);\r\n                // SignPanel._main.position = cc.p(0, 0);\r\n                // SignPanel._main.setScale(1.2);\r\n                // SignPanel._main.opacity = 0;\r\n                // SignPanel._main.runAction(self.actionFadeIn);\r\n                SignPanel._animation.play(\"popup_signnode_show\");\r\n            };\r\n\r\n            // 执行弹出动画\r\n            self.startFadeOut = function () {\r\n                SignPanel._sign.pauseSystemEvents(true);\r\n                // cc.eventManager.pauseTarget(SignPanel._main, true);\r\n                // if(SignPanel._main != null)\r\n                // {\r\n                //     SignPanel._main.runAction(self.actionFadeOut);\r\n                // }\r\n                SignPanel._animation.play(\"popup_signnode_hide\");\r\n            };\r\n\r\n            // // 弹进动画完成回调\r\n            // self.onFadeInFinish = function () {\r\n            //     cc.eventManager.resumeTarget(SignPanel._sign, true);\r\n            // };\r\n\r\n            // // 弹出动画完成回调\r\n            // self.onFadeOutFinish = function () {\r\n            //     self.onDestory();\r\n            // };\r\n\r\n            // 按钮点击事件\r\n            self.onButtonClicked = function (event) {\r\n                GameManager.getInstance().Sign(function (resp) {\r\n                    PopupTipsNode.appearWithText('领取成功')\r\n                    if (SignPanel._enterCallBack != null) {\r\n                        SignPanel._enterCallBack(resp);\r\n                    }\r\n                    AudioManager.getInstance().playEffect(AudioManager.EFFECT_TYPE.MONEY);\r\n                },SignPanel._type)\r\n                SignPanel._sign.stopAllActions();\r\n                self.startFadeOut();\r\n            };\r\n\r\n            self.onCloseBtnClicked = function (event) {\r\n                self.startFadeOut();\r\n            };\r\n\r\n            // 销毁 sign \r\n            self.onDestory = function () {\r\n                SignPanel._sign.destroy();\r\n                SignPanel._sign = null;\r\n                SignPanel._detailLabel = null;\r\n                SignPanel._enterCallBack = null;\r\n\r\n            };\r\n            \r\n            AudioManager.getInstance().playEffect(AudioManager.EFFECT_TYPE.POPUP);\r\n        }\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n\r\n});"]}